<!DOCTYPE html>
<html lang="ja">
<head> 
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff0000">
<link rel="apple-touch-icon" href="icon.png">
<link rel="stylesheet" href="style.css">
<meta charset="UTF-8">
<title>Bike Manager</title>

<style>
body {
  font-family: sans-serif;
  font-size: 18px;
  margin: 10px;
  background: #111;
  color: #fff;
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
}

/* ヘッダー */
.header {
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 10px;
}

/* 警告 */
.alert {
  background: #330000;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 8px;
}

/* 入力 */
input, select {
  width: 100%;
  height: 44px;
  font-size: 18px;
  margin-bottom: 10px;
  border-radius: 6px;
  border: none;
  padding: 5px;
}

button {
  width: 100%;
  height: 48px;
  font-size: 18px;
  margin-bottom: 10px;
  border-radius: 8px;
  border: none;
  background: red;
  color: white;
}

/* 履歴 */
.log {
  background: #222;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 6px;
}

/* カテゴリ色 */
.oil { color: #4da6ff; }
.parts { color: #aaa; }
.chemical { color: #66ff99; }
.consumable { color: #ff6666; }

</style>
</head>

<body>

<div class="header">CBR Maintenance Log</div>

<div id="alert" class="alert"></div>

<select id="part">
  <option>オイル</option>
  <option>チェーン</option>
  <option>ブレーキパッド</option>
  <option>ブレーキフルード</option>
</select>

<input type="number" id="qty" placeholder="数量（+ or -）">

<input type="date" id="date">

<input type="text" id="note" placeholder="メモ">

<button onclick="save()">保存</button>

<h3>履歴</h3>
<div id="logs"></div>

<script>
let logs = JSON.parse(localStorage.getItem("logs")) || [];

function save() {
  const part = document.getElementById("part").value;
  const qty = Number(document.getElementById("qty").value);
  const date = document.getElementById("date").value;
  const note = document.getElementById("note").value;

  logs.push({ part, qty, date, note });

  localStorage.setItem("logs", JSON.stringify(logs));
  render();
}

function getStock(part) {
  return logs
    .filter(l => l.part === part)
    .reduce((sum, l) => sum + l.qty, 0);
}

function render() {
  const logDiv = document.getElementById("logs");
  const alertDiv = document.getElementById("alert");

  logDiv.innerHTML = "";
  alertDiv.innerHTML = "";

  logs.slice().reverse().forEach(l => {
    const div = document.createElement("div");
    div.className = "log";
    div.innerHTML = `
      ${l.date} / ${l.part} / ${l.qty} / ${l.note}
    `;
    logDiv.appendChild(div);
  });

  // 在庫チェック
  const parts = ["オイル", "チェーン", "ブレーキパッド", "ブレーキフルード"];
  parts.forEach(p => {
    if (getStock(p) <= 1) {
      alertDiv.innerHTML += `⚠ ${p} 在庫少ない<br>`;
    }
  });
}

render();
</script>

</body>
</html>